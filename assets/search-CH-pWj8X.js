import{c as f}from"./storage-kfwF2ZLp.js";/* empty css                 */let i,a;function g(){i=L.map("map").setView([10.9685,-74.7813],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"© OpenStreetMap contributors"}).addTo(i),a=L.layerGroup().addTo(i)}function h(o,n){const e=L.latLngBounds([]);if(n){const t=L.icon({iconUrl:"../img/pin-de-ubicacion%201.png",iconSize:[38,38],iconAnchor:[19,38],popupAnchor:[0,-30]});L.marker(n,{icon:t}).addTo(a).bindPopup("¡Estás aquí!").openPopup(),e.extend(n)}o.forEach(t=>{if(t.latitude&&t.longitude){const p=L.marker([t.latitude,t.longitude]).addTo(a).bindPopup(`<b>${t.point_name}</b><br>${t.address}<br>Stock: ${t.quantity}`);e.extend(p.getLatLng())}}),e.isValid()&&i.fitBounds(e,{padding:[50,50]})}function b(){a&&a.clearLayers()}const v="http://localhost:3000";async function y(o,n){const e=await fetch(`${v}/search_medicine?medicine_name=${encodeURIComponent(o)}&eps_id=${n}`);if(e.status===404)return[];if(!e.ok)throw new Error("Fallo en la búsqueda de resultados.");return e.json()}const r=document.getElementById("pointsList");function m(o,n){r.innerHTML="",o.length===0?r.innerHTML=`<li class="no-results">No se encontraron medicamentos para **${n}** en las farmacias afiliadas.</li>`:o.forEach(e=>{const t=document.createElement("li");t.classList.add("points-list__item"),t.innerHTML=`
                <div class="points-list__name">${e.point_name}</div>
                <div class="points-list__address">${e.address}</div>
                <div class="points-list__stock">
                    <span class="pill pill--success">Disponible</span>
                    <span class="pill pill--stock">Stock: ${e.quantity}</span>
                </div>
            `,r.appendChild(t)})}function E(){f(),window.location.href="../view/login.html"}const _=JSON.parse(localStorage.getItem("user"));_||(window.location.href="../../index.html");const w=document.getElementById("medicine"),d=document.getElementById("searchForm"),u=document.getElementById("logoutBtn");u&&u.addEventListener("click",E);const c=1;let s=null;function k(){g(),S()}function S(){d&&d.addEventListener("submit",B)}async function B(o){o.preventDefault();const n=w.value;if(!n){alert("Por favor, ingresa un nombre de medicamento.");return}b(),m([],n),navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{s=[e.coords.latitude,e.coords.longitude],await l(n,c)},async e=>{console.error("Error al obtener la ubicación del usuario:",e),alert("No se pudo obtener tu ubicación. Buscando farmacias sin tu posición."),s=null,await l(n,c)}):(alert("Tu navegador no soporta la geolocalización. Buscando farmacias sin tu posición."),s=null,await l(n,c))}async function l(o,n){try{const e=await y(o,n);h(e,s),m(e,o)}catch(e){console.error("Error durante la búsqueda:",e),alert("Ocurrió un error al buscar. Por favor, inténtalo de nuevo.")}}document.addEventListener("DOMContentLoaded",k);
