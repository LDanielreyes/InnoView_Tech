import{s as a}from"./storage-kfwF2ZLp.js";const i="http://localhost:3000";async function l(r,o={}){try{const e=await fetch(`${i}${r}`,{headers:{"Content-Type":"application/json"},...o}),t=await e.json();if(!e.ok)throw new Error(t.message||"API request failed");return{success:t.success||!1,message:t.message||null,user:t.user||null,data:t.data||null}}catch(e){throw console.error("API Error:",e.message),e}}async function u(r){return l("/auth/register",{method:"POST",body:JSON.stringify(r)})}async function c(r){return l("/auth/login",{method:"POST",body:JSON.stringify(r)})}const n=document.getElementById("registerForm");n&&n.addEventListener("submit",async r=>{r.preventDefault();const o={name:document.getElementById("name").value,document_type:document.getElementById("document_type").value,document_number:document.getElementById("document_number").value,phone:document.getElementById("phone").value,eps:document.getElementById("eps").value,email:document.getElementById("email").value,password:document.getElementById("password").value};try{const e=await u(o);e.success?(alert("User registered successfully! Please log in."),window.location.href="../login/login.html"):alert(e.message||"Error during registration")}catch(e){console.error("Register error:",e),alert("Server error during registration")}});const s=document.getElementById("loginForm");s&&s.addEventListener("submit",async r=>{r.preventDefault();const o={email:document.getElementById("email").value,password:document.getElementById("password").value};try{const e=await c(o);if(e.success&&e.user){const t={id:e.user.id,full_name:e.user.full_name,email:e.user.email,role:e.user.role,token:e.user.token||null,id_authorized_point:e.user.id_authorized_point||null};a(t),console.log("✅ Saved user session:",t),t.role==="PACIENTE"?(console.log("➡ Redirecting PACIENTE to search.html"),window.location.href="../view/search.html"):t.role==="FARMACEUTICO"?(console.log("➡ Redirecting FARMACEUTICO to inventory.html"),window.location.href="../view/inventory.html"):(console.log("➡ Redirecting fallback to home"),window.location.href="../../index.html")}else alert(e.message||"Invalid credentials")}catch(e){console.error("Login error:",e),alert("Server error during login")}});
